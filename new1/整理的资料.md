nb_queues ： //队列
nb_ports：//dpdk
nb_hairpin_q：//
sudo echo 2048 > /sys/kernel/mm/hugepages/hugepages-2048kB/nr_hugepages
Stateful Flow Table SFT DPDK
多线程：https://blog.csdn.net/ApeLife/article/details/100598799
sf资料：https://docs.nvidia.com/doca/sdk/scalable-functions/index.html
巨页 cat /proc/meminfo

RSS(Receive Side Scaling)是一种能够在多处理器系统下使接收报文在多个CPU之间高效分发的软件技术。 
https://zhuanlan.zhihu.com/p/544142007#:~:text=%E4%B8%8D%E8%BF%87DPDK%E4%B8%ADRSS%E6%98%AF%E5%9F%BA%E4%BA%8E%E7%AB%AF%E5%8F%A3%E7%9A%84%EF%BC%88%E5%8D%B3%E9%92%88%E5%AF%B9%E6%9F%90%E4%B8%AA%E7%BD%91%E5%8D%A1%E7%9A%84%EF%BC%89%EF%BC%8C%E5%B9%B6%E6%A0%B9%E6%8D%AE%E7%AB%AF%E5%8F%A3%E7%9A%84%E6%8E%A5%E6%94%B6%E9%98%9F%E5%88%97%E8%BF%9B%E8%A1%8C%E6%8A%A5%E6%96%87%E5%88%86%E5%8F%91%E7%9A%84%E3%80%82%20%E4%BE%8B%E5%A6%82%E6%88%91%E4%BB%AC%E5%9C%A8%E4%B8%80%E4%B8%AA%E7%AB%AF%E5%8F%A3%E4%B8%8A%E9%85%8D%E7%BD%AE%E4%BA%863%E4%B8%AA%E6%8E%A5%E6%94%B6%E9%98%9F%E5%88%97%20%280%2C1%2C2%29%E5%B9%B6%E5%BC%80%E5%90%AF%E4%BA%86RSS%EF%BC%8C%E9%82%A3%E4%B9%88,%28redirection%20table%29%E5%B0%B1%E6%98%AF%E8%BF%99%E6%A0%B7%E7%9A%84%3A%20%7B0%2C1%2C2%2C0%2C1%2C2%2C0.........%7D

l2:
dpu :cd xsk/bf2/doca/l2fwd/build
sudo ./doca_l2fwd -m 1024 -b 03:00.0 -- -p 1 -q 1 -b 0
sudo ./doca_l2fwd -m 1024 -b 03:00.0 -- -p 2 -q 1 -b 0

sudo ./doca_l2fwd -m 1024 -b 03:00.0 -- -p 3 -q 1 -b 0

host :cd /home/xsk/project/bf2/src/dpdk/l2fwd/build
 sudo ./l2fwd -m 1024 -a 01:00.1 -- -r 0 -t 0 -q 6 --rxonly -e 1000
 
sudo ./pktgen -m 1024 -a 5e:00.1 --proc-type auto -- -P -m [1:2].0

接收端缩放 (RSS) 

/* convert to number of cycles */
    //将秒数转换为了时钟周期个数
    //timer_period之前获取的是秒数，这里乘上了一秒的时钟周期个数。

vnf   
host/dpu运行
为什么host能抓包

set 0 src ip 192.168.0.1/32
https://cloud.tencent.com/developer/article/1883053 抓包


switch/vnf/remote-vnf ：
vnf是对于embedded模式，然后运行在arm上。
switch是separated host mode，端口之间是做转发，不支持hairpin。
remote-vnf 是对于embedded模式，然后运行在host上
重启后
export PKG_CONFIG_PATH=${PKG_CONFIG_PATH}:/opt/mellanox/doca/lib/aarch64-linux-gnu/pkgconfig
export PATH=${PATH}:/opt/mellanox/doca/tools

simple_fwd备份

./doca_simple_fwd_vnf -a auxiliary:mlx5_core.sf.4 -a auxiliary:mlx5_core.sf.5 -- -l 4


sf设备命令：
/opt/mellanox/iproute2/sbin/mlxdevm port show
mst status -v
ip link show |grep s4
sudo mlnx-sf --action show
devlink dev show
https://blog.csdn.net/envy13/article/details/80241886 numa资料
https://www.jianshu.com/p/3fddb66f46ce dpdk基本资料
https://docs.nvidia.com/doca/sdk/scalable-functions/index.html删除sf

unlikely----提高命中率
__attribute__：？也跟性能提升有关？

dpdk 部分宏定义
#define RX_RING_SIZE 1024 //接收环的大小
#define TX_RING_SIZE 1024 //发送环的大小

#define NUM_MBUFS 8191 //每个网口可以挂最多NUM_MBUFS个包（RX+TX）
#define MBUF_CACHE_SIZE 250 //与内存及高速缓存器有关
#define BURST_SIZE 32  //调用一次函数，从物理层获取的最大包数量
//网口默认配置，RX接收的数据包大小默认为ETHER链路帧包的最大值（MTU）
https://cloud.tencent.com/developer/article/1564510 GRE和VXLAN
https://blog.csdn.net/Fly_hps/article/details/80626636网络隧道
argv是一个指针

https://www.sdnlab.com/sdn-guide/14736.html基本网络知识
pktgen

Flow 一组相同类型的packet组成的数据流就是flow。类型的区分由match域的值决定。

Table就是表，用来存东西。比如用来存流表项的表称为流表 flow table

流表项用来指导一条数据流的处理方法，流表项称为flow entry.

meter表


https://blog.csdn.net/weixin_42571882/article/details/122381496?spm=1001.2014.3001.5502 dpdk参数

https://www.cnblogs.com/goldsunshine/p/10959199.html ovs使用
ovs-ofctl show / 
ovs-ofctl dump-flows

1.doca_flow_init
2.doca_flow_port_start()
3.


#!/bin/bash



Pktgen:/> set 0 size 64 // 将网口 0 发包的帧大小设置 64 字节
Pktgen:/> set 0 src ip 192.168.0.1/32 // 将网口 0 发包的源 IP 设置为 192.168.0.1
Pktgen:/> set 0 dst ip 192.168.0.2 // 将网口 0 发包的目的 IP 设置为 192.168.0.2
Pktgen:/> start 0 // 启动网口 0 的发包过程
Pktgen:/> stop 0 // 停止网口 0 的发包过程
Pktgen:/> quit // 退出 pktgen 程序
set 0 dport 80 /sport

devlink port show看一些端口信息


# 创建 tap 
ip tuntap add dev tap0 mode tap 
# 创建 tun
ip tuntap add dev tun0 mode tun 
# 删除 tap
ip tuntap del dev tap0 mode tap
# 删除 tun
ip tuntap del dev tun0 mode tun 

/sys/class/net/设备/ifindex 对应pktgen可以借此查看网卡

virsh nodedev-list
https://www.cnblogs.com/sctb/p/13848201.html

主机端测速：
cd /home/xsk/project/bf2/src/dpdk/l2fwd/build
sudo ./l2fwd -a 01:00.1 -- -r 0 -q 1 -rxonly -e 1000

echo 4 > sriov_numvfs
创建vf需要先清零

range 0 src ip 192.168.0.1 192.168.0.1 192.168.0.3 0.0.0.1
enable all range（通过设置不同数据包大小处理？）

echo 2048 > /sys/kernel/mm/hugepages/hugepages-2048kB/nr_hugepages

pktgen -m 1024 -a 5e:00.1  -a 5e:01.2   -a 5e:01.3  -a 5e:01.4  -a 5e:01.5 --  -m 1.0,2.1,3.2,4.3,5.4
set 0 dst mac b8:ce:f6:d5:cc:50
set 0 dst ip 192.168.201.1
set 1 dst mac b8:ce:f6:d5:cc:50
set 1 dst ip 192.168.201.2
set 2 dst mac b8:ce:f6:d5:cc:50
set 2 dst ip 192.168.201.3
set 3 dst mac b8:ce:f6:d5:cc:50
set 3 dst ip 192.168.201.4


./l2fwd -a 01:02.3 -- -r 0 -q 1 -rxonly -e 1000

tcpdump -i enp1s0f1np1 -c 1000 -n


cd /home/markchen/markchen/work/SPLB/dpdk/pktgen-dpdk-pktgen-21.11.0/build/app
./pktgen -m 1024 -a 01:00.1  -a 01:02.3   -a 01:02.4  -a 01:02.5   --  -m 1.0,2.1,3.2,4.3

arp -s ip mac 
ifconfig eth up/down
ifcongig 


./l2fwd -l 0-3 -a 01:02.3 -a 01:00.1 --proc-type auto --  -r 0 -q 2  -rxonly -e 1000



抓arp包：tcpdump -i enp1s0f1np1 arp host 192.168.201.2 



ovs:
ovs-ofctl dump-flows br1
ovs-ofctl add-flow br1 "action=NORMAL"
ovs-ofctl del-flows br1
ovs-ofctl add-flow br1 in_port=pf1hpf,actions=output:p1


